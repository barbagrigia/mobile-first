<!--
The `mobile-first` element takes "Mobile First" to a whole new level. If viewed
on a desktop or large mobile device, it will embed its content within a mock
image of a mobile device. This will allow your users to experience your site as
you originally intended.

Tip: try giving both `body` and `html` styles of 100% height and zero margin,
as this will allow your `mobile-first` experience to take up the whole page.

<b>Example</b>:

    <mobile-first>
      <h5>Your Page!</h5>
    </mobile-first>

@element mobile-first
@status alpha
@homepage http://github.com/samthor/mobile-first
-->

<polymer-element name="mobile-first" attributes="mobile">
<template>
  <style>

  :host {
    display: block;
    height: 100%;
  }

  #wrapper {
    position: relative;
    height: 100%;
    min-height: calc(568px + 8px);
  }

  #device {
    display: none;
    width: 100%;
    height: 100%;
    background-repeat: no-repeat;
    background-position: center;
  }

  .enabled #device {
    display: block;
  }

  #screen {
    height: 100%;
  }

  .enabled #screen {
    position: absolute;
    width: 320px;
    height: 568px;
    top: 50%;
    left: 50%;
    margin-top: -284px;
    margin-left: -160px;
    background: rgba(255, 255, 255, 0.95);
    border-radius: 2px;
    overflow: scroll;
  }

  .d-iphone5 #device {
    background-image: url(devices/iphone5.png);
    background-size: 410px 820px;
  }

  </style>

<div id="wrapper" class="d-iphone5">
  <div id="device">
  </div>
  <div id="screen">
    <content></content>
  </div>
</div>

</template>
<script>

Polymer({

    /**
     * Width (or below) at which this element is recognized as a mobile device.
     */
    mobile: 768,

    created: function() {
    },

    ready: function() {
      // TODO: Use a shrink/grow scroll hack listener to do this.
      window.addEventListener('resize', this.updateMF_.bind(this));
      this.updateMF_();
    },

    attributeChanged: function(attrName, oldVal, newVal) {
      this.updateMF_();
    },

    updateMF_: function() {
      console.info('mobile', this.isMobile);
      this.$.wrapper.classList.toggle('enabled', !this.isMobile);
    },

    get isMobile() {
      //var isMobile = (typeof window.orientation !== 'undefined');
      var rect = this.getBoundingClientRect();
      return rect.width <= this.mobile || rect.height <= this.mobile / 2;
    }

  });
</script>
</polymer-element>
