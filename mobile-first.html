<!--
The `mobile-first` element takes "Mobile First" to a whole new level. If viewed
on a desktop or large mobile device, it will embed its content within a mock
image of a mobile device. This will allow your users to experience your site as
you originally intended.

Tip: try giving both `body` and `html` styles of 100% height and zero margin,
as this will allow your `mobile-first` experience to take up the whole page.

<b>Example</b>:

    <mobile-first>
      <h5>Your Page!</h5>
    </mobile-first>

@element mobile-first
@status alpha
@homepage http://github.com/samthor/mobile-first
-->

<polymer-element name="mobile-first" attributes="mobile src">
<template>
  <style>

  .hidden {
    display: none !important;
  }

  :host {
    display: block;
    height: 100%;
  }

  #wrapper {
    position: relative;
    height: 100%;
    min-height: calc(568px + 8px);
  }

  #device {
    display: none;
    width: 100%;
    height: 100%;
    background-repeat: no-repeat;
    background-position: center;
  }

  .enabled #device {
    display: block;
  }

  #screen {
    height: 100%;
  }

  #screen iframe {
    display: none;
    width: 100%;
    height: 100%;
    border: 0;
  }

  .enabled #screen {
    position: absolute;
    width: 320px;
    height: 568px;
    top: 50%;
    left: 50%;
    margin-top: -284px;
    margin-left: -160px;
    background: rgba(255, 255, 255, 0.95);
    border-radius: 2px;
    overflow: scroll;
  }

  .enabled #screen iframe {
    display: block;
  }

  .d-iphone5 #device {
    background-image: url(devices/iphone5.png);
    background-size: 410px 820px;
  }

  </style>

<div id="wrapper" class="d-iphone5">
  <div id="device">
  </div>
  <div id="screen">
    <div id="content" class="hidden">
      <content></content>
    </div>
    <iframe id="iframe" class="hidden "/>
  </div>
</div>

</template>
<script>

Polymer({

    /**
   * Width (or below) at which this element is recognized as a mobile device.
   */
  mobile: 768,

  /**
   * If set, used as the source of an iframe within this element.
   */
  src: null,

  created: function() {
    console.warn('???');
  },

  ready: function() {
    // TODO: Use a shrink/grow scroll hack listener to do this.
    window.addEventListener('resize', this.updateMF_.bind(this));
    this.updateMF_();
  },

  attributeChanged: function(attrName, oldVal, newVal) {
    switch (attrName) {
    case 'src':
      this.$.content.classList.toggle('hidden', !newVal);
      this.$.iframe.classList.toggle('hidden', !!newVal);
      this.$.iframe.src = newVal;
      break;
    case 'width':
      this.updateMF_();
      break;
    }
    console.debug('attributeChanged', attrName, newVal);
  },

  updateMF_: function() {
    var isMobile = this.isMobile;

    console.info('mobile', isMobile);
    this.$.wrapper.classList.toggle('enabled', !isMobile);

    var window = this.$.iframe.contentWindow;
    var userAgentProp = {
      get: function() {
        // TODO: only mobile?
        return "Mozilla/5.0 (Linux; U; Android 4.0; en-us; LT28at Build/6.1.C.1.111) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30";
      },
      set: function(v) { console.warn('something tried to set ua', v); }
    };
    Object.defineProperty(window.navigator, 'userAgent', userAgentProp);
  },

  get isMobile() {
    //var isMobile = (typeof window.orientation !== 'undefined');
    var rect = this.getBoundingClientRect();
    return rect.width <= this.mobile || rect.height <= this.mobile / 2;
  }

});

</script>
</polymer-element>
